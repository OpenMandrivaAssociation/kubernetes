From b13efe3e00ace16c1eb3a8316839ce7c726a899d Mon Sep 17 00:00:00 2001
From: Jan Chaloupka <jchaloup@redhat.com>
Date: Sat, 10 Oct 2015 02:46:49 +0200
Subject: [PATCH] hack test-cmd for o4n

---
 hack/lib/init.sh |  2 +-
 hack/test-cmd.sh | 10 +++++-----
 2 files changed, 6 insertions(+), 6 deletions(-)

diff --git a/hack/lib/init.sh b/hack/lib/init.sh
index 8a2c428..992aa18 100644
--- a/hack/lib/init.sh
+++ b/hack/lib/init.sh
@@ -39,4 +39,4 @@ source "${KUBE_ROOT}/hack/lib/version.sh"
 source "${KUBE_ROOT}/hack/lib/golang.sh"
 source "${KUBE_ROOT}/hack/lib/etcd.sh"
 
-KUBE_OUTPUT_HOSTBIN="${KUBE_OUTPUT_BINPATH}/$(kube::util::host_platform)"
+KUBE_OUTPUT_HOSTBIN="${KUBE_OUTPUT_HOSTBIN:-${KUBE_OUTPUT_BINPATH}/$(kube::util::host_platform)}"
diff --git a/hack/test-cmd.sh b/hack/test-cmd.sh
index 2ffa525..d10d451 100755
--- a/hack/test-cmd.sh
+++ b/hack/test-cmd.sh
@@ -163,7 +163,7 @@ runTests() {
       -s "http://127.0.0.1:${API_PORT}"
       --match-server-version
     )
-    [ "$(kubectl get nodes -o go-template='{{ .apiVersion }}' "${kube_flags[@]}")" == "v1" ]
+    [ "$(kubectl get nodes -o template --template="{{ .apiVersion }}" "${kube_flags[@]}")" == "v1" ]
   else
     kube_flags=(
       -s "http://127.0.0.1:${API_PORT}"
@@ -191,7 +191,7 @@ runTests() {
 
   # Make sure the UI can be proxied
   start-proxy --api-prefix=/
-  check-curl-proxy-code /ui 301
+  check-curl-proxy-code /ui 404
   check-curl-proxy-code /metrics 200
   if [[ -n "${version}" ]]; then
     check-curl-proxy-code /api/${version}/namespaces 200
@@ -210,7 +210,7 @@ runTests() {
 
   # Custom paths let you see everything.
   start-proxy --api-prefix=/custom
-  check-curl-proxy-code /custom/ui 301
+  check-curl-proxy-code /custom/ui 404
   check-curl-proxy-code /custom/metrics 200
   if [[ -n "${version}" ]]; then
     check-curl-proxy-code /custom/api/${version}/namespaces 200
@@ -788,8 +788,8 @@ __EOF__
   kubectl create -f examples/cassandra/cassandra-controller.yaml "${kube_flags[@]}"
   kubectl scale rc cassandra --replicas=1 "${kube_flags[@]}"
   kubectl create -f examples/cassandra/cassandra-service.yaml "${kube_flags[@]}"
-  kube::test::get_object_assert "all -l'name=cassandra'" "{{range.items}}{{range .metadata.labels}}{{.}}:{{end}}{{end}}" 'cassandra:cassandra:cassandra:'
-  kubectl delete all -l name=cassandra "${kube_flags[@]}"
+  kube::test::get_object_assert "rc,services,pods -l'name=cassandra'" "{{range.items}}{{range .metadata.labels}}{{.}}:{{end}}{{end}}" 'cassandra:cassandra:cassandra:'
+  kubectl delete rc,services,pods -l name=cassandra "${kube_flags[@]}"
 
 
   ###########
-- 
1.9.3

